<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digimon Bingo Card</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .checked {
            background-color: #d4edda !important;
            opacity: 0.7;
        }
        .free {
            background-color: #ffd700 !important;
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">
    <div id="loading" class="text-center text-lg font-semibold text-gray-700">
        Loading Digimon Bingo Card... If this persists, check the browser console (F12) for errors or ensure an internet connection.
    </div>
    <div id="bingo-card" class="grid grid-cols-5 gap-2 max-w-2xl w-full p-4 hidden">
        <!-- Bingo card cells will be dynamically inserted here -->
    </div>
    <button id="refresh-button" class="mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded hidden">
        Generate New Card
    </button>

    <script>
        // Digimon list with all corrections applied, fixing FunBeemon to Funbeemon
        const digimonList = [
            "Kuramon", "Bubbmon", "Punimon", "Botamon", "Poyomon", "Arkadimon Baby", "Koromon", "Tanemon", 
            "Tunomon", "Tsumemon", "Tokomon", "Nyaromon", "Pagumon", "Pyocomon", "Pukamon", "Mochimon", "Wanyamon", 
            "Agumon", "Agumon (Black)", "Arkadimon Child", "Armadimon", "Impmon", "Elecmon", "Otamamon", "Gaomon", 
            "Gazimon", "Gabumon", "Gabumon (Black)", "Guilmon", "Kudamon", "Keramon", "Gottsumon", "Goburimon", 
            "Gomamon", "Shakomon", "Zubamon", "Solarmon", "Tyumon", "Terriermon", "Tentomon", "ToyAgumon", "Dracumon", 
            "Dracumon", "Dorumon", "Hagurumon", "Patamon", "Hackmon", "Palmon", "Petitmon", "Piyomon", "Falcomon", 
            "Funbeemon", "V-mon", "Plotmon", "Betamon", "Hawkmon", "Mushmon", "Monodramon", "Lalamon", "Lucemon", 
            "Lunamon", "Renamon", "Lopmon", "Wormmon", "Ryudamon", "Sistermon Blanc", "Sistermon Blanc (Awake)", 
            "IceDevimon", "Icemon", "Aquilamon", "Agnimon", "Arkadimon Adult", "Ankylomon", "Ikkakumon", 
            "Wizarmon", "Wolfmon", "Woodmon", "Airdramon", "XV-mon", "Angemon", "Orgemon", "Guardromon", 
            "Guardromon (Gold)", "Gaogamon", "Kabuterimon", "Karatuki Numemon", "Galgomon", "Garurumon", "Garurumon (Black)", 
            "Kyubimon", "Growmon", "Chrysalimon", "Greymon", "Greymon (Blue)", "Clockmon", "Kuwagamon", "Gekomon", 
            "Geremon", "Coredramon (Blue)", "Coredramon (Green)", "Gold Numemon", "Golemon", "Cyclomon", "Sangloupmon", 
            "Sunflowmon", "Seadramon", "Coelamon", "GeoGreymon", "Sukamon", "Starmon", "Stingmon", "Strikedramon", 
            "Zubaeagermon", "Sorcerimon", "Tankmon", "Tuchidarumon", "Tyranomon", "Tailmon", "Devimon", "Turuiemon", 
            "Togemon", "Dorugamon", "Nanimon", "Numemon", "Birdramon", "Bao Hackmon", "Bakemon", "V-dramon", "Hudiemon", 
            "PlatinumSukamon", "BlackTailmon", "Vegimon", "Peckmon", "Meramon", "Monochromon", "Yukidarumon", "Unimon", 
            "Raptordramon", "Raremon", "Leomon", "Lekismon", "Reppamon", "Waspmon", "Sistermon Ciel", 
            "Sistermon Ciel (Awake)", "Atlur Kabuterimon (Blue)", "Atlur Kabuterimon (Red)", "Andiramon", "Andromon", "Insekimon", 
            "Infermon", "Vamdemon", "Wingdramon", "Vritramon", "AeroV-dramon", "Etemon", "Angewomon", "Okuwamon", 
            "Garudamon", "Garummon", "Gigadramon", "CatchMamemon", "Cannonbeemon", "Groundramon", "Grappu Leomon", 
            "Grademon", "Crescemon", "Cyberdramon", "Shakkoumon", "Jyureimon", "Silphymon", "Superstarmon", "Skull Satamon", 
            "Skull Satamon", "Zudomon", "Savior Hackmon", "Taomon", "Dagomon", "Tyilinmon", "Dinobeemon", "Digitamamon", 
            "DeathMeramon", "Duramon", "Tonosama Gekomon", "Triceramon", "DORUguremon", "Knightmon", "Nanomon", "Paildramon", 
            "Panjyamon", "Pandamon", "Pumpmon", "Piccolomon", "Hippogriffomon", "Fantomon", "BlackKingNumemon", 
            "BlueMeramon", "Vademon", "Whamon", "HolyAngemon", "Volcamon", "Matadrmon", "MachGaogamon", "Mamemon", 
            "MegaSeadramon", "Megadramon", "Megalo Growmon", "MetalGreymon", "Metal Greymon (Virus)", "MetalTyranomon", 
            "MetalMamemon", "Monzaemon", "Yatagaramon", "RizeGreymon", "Lilamon", "Rapidmon Perfect", "Lilimon", 
            "Lucemon(Falldown Mode)", "LadyDevimon", "WereGarurumon", "WereGarurumon (Black)", "Wisemon", "Arkadimon Ultimate", 
            "Alphamon", "UlforceV-dramon", "Ebemon", "Imperialdramon(Dragon Mode)", "Imperialdramon(Fighter Mode)", "Vikemon", 
            "Valkyrimon", "Valdurmon", "VenomVamdemon", "WarGreymon", "Ofanimon", "Gaioumon", "KaiserGreymon", 
            "Chaos Dukemon", "Chaosdramon", "Gankoomon", "KingEtemon", "Kuzuhamon", "GranKuwagamon", "Grand Dracumon", 
            "Grand Locomon", "Griffomon", "Craniummon", "Cherubimon (Vice)", "Cherubimon (Virtue)", "Goddramon", 
            "SaberLeomon", "Sakuyamon", "Jesmon", "ShineGreymon", "ShineGreymon(Burst Mode)", "Justimon(Blitz Arm)", "Sleipmon", 
            "Slayerdramon", "Seraphimon", "Saint Galgomon", "Darkdramon", "TigerVespamon", "Titamon", "TyrantKabuterimon", 
            "Dianamon", "Diablomon", "Demon", "Dukemon", "Dynasmon", "Durandamon", "Duftmon(Leopard Mode)", 
            "Dorugoramon", "Neptunemon", "HiAndromon", "PileVolcamon", "Barbamon", "BanchoLeomon", "Piemon", 
            "Pinochimon", "PlatinumNumemon", "BlackWarGreymon", "PrinceMamemon", "Breakdramon", "Plesiomon", 
            "HerakleKabuterimon", "Beelzebumon", "Beelzebumon(Blast Mode)", "Belphemon(Sleep Mode)", "Hououmon", 
            "Holydramon", "Boltmon", "MagnaGarurumon", "MagnaGarurumon (detached)", "Marin Angemon", "Minervamon", 
            "MirageGaogamon(Burst Mode)", "Mercurymon", "Ravmon", "Ravmon(Burst Mode)", "Rosemon(Burst Mode)", "Lotusmon", 
            "Alphamon(Ouryuken)", "Imperialdramon(Paladin Mode)", "Examon", "Omegamon", "Omegamon Zwart", "Chaosmon", 
            "Chaosmon(Valdur Arm)", "Susanoomon", "Dukemon(Crimson Mode)", "Belphemon(Rage Mode)", "Lucemon(Satan Mode)", 
            "Fladramon", "Magnamon", "Rapidmon Armor", "Omega Shoutmon"
        ];

        // Fallback image URL
        const fallbackImage = 'https://i.imgur.com/gRDjlBD.png';
        const freeSquareImage = 'https://p1.hiclipart.com/preview/133/792/21/digimon-adventure-digivices-hq-base-purple-digimon-digivice.jpg';

        // Function to normalize name for API
        function normalizeNameForAPI(name) {
            let apiName = name;
            // Insert space before second capital letter only if not already spaced or in parentheses
            apiName = apiName.replace(/([a-z0-9])\s*([A-Z])(?![^(]*\))/g, '$1 $2');
            // Insert space after "Metal", "Gold", or "Rust" for relevant Digimon
            apiName = apiName.replace(/Metal([A-Z])/g, 'Metal $1');
            apiName = apiName.replace(/Gold([A-Z])/g, 'Gold $1');
            apiName = apiName.replace(/Rust([A-Z])/g, 'Rust $1');
            // Cherubimon variants
            if (apiName.includes('Cherubimon (Aku)')) {
                apiName = apiName.replace('Cherubimon (Aku)', 'Cherubimon (Vice)');
            }
            if (apiName.includes('Cherubimon (Zen)')) {
                apiName = apiName.replace('Cherubimon (Zen)', 'Cherubimon (Virtue)');
            }
            // Leopardmon Leopard Mode
            if (apiName === 'Leopardmon Leopard Mode') {
                apiName = 'Duftmon(Leopard Mode)';
            }
            // Handle Burst Modes (ensure no space before parentheses)
            if (apiName.includes('(Burst Mode)')) {
                apiName = apiName.replace(' (Burst Mode)', '(Burst Mode)');
            }
            if (apiName.includes('(Blast Mode)')) {
                apiName = apiName.replace(' (Blast Mode)', '(Blast Mode)');
            }
            return apiName;
        }

        // Function to shuffle array (Fisher-Yates shuffle)
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to fetch Digimon image from Digi-API with fallback
        async function fetchDigimonImage(name) {
            const apiName = normalizeNameForAPI(name);
            try {
                const response = await fetch(`https://digi-api.com/api/v1/digimon/${encodeURIComponent(apiName)}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                return data.images?.[0]?.href || fallbackImage;
            } catch (error) {
                console.warn(`Error fetching image for ${name} (API: ${apiName}):`, error);
                return fallbackImage;
            }
        }

        // Function to generate bingo card
        async function generateBingoCard() {
            const loading = document.getElementById('loading');
            const bingoCard = document.getElementById('bingo-card');
            const refreshButton = document.getElementById('refresh-button');
            
            // Clear previous card
            bingoCard.innerHTML = '';
            
            // Shuffle Digimon list and select 25
            const shuffledDigimon = shuffle([...digimonList]).slice(0, 25);
            
            // Create bingo card cells
            for (let i = 0; i < 25; i++) {
                const digimonName = shuffledDigimon[i];
                const imageUrl = await fetchDigimonImage(digimonName);
                const isCenter = i === 12;
                
                const cell = document.createElement('div');
                cell.className = 'bg-white p-2 rounded shadow flex flex-col items-center justify-center h-32 cursor-pointer relative';
                if (isCenter) {
                    cell.classList.add('free');
                    cell.innerHTML = `
                        <img src="${freeSquareImage}" alt="FREE" class="w-16 h-16 object-contain mb-2 opacity-50">
                        <span class="text-xs text-center font-semibold text-yellow-800">FREE</span>
                    `;
                } else {
                    cell.innerHTML = `
                        <img src="${imageUrl}" alt="${digimonName}" class="w-16 h-16 object-contain mb-2" onerror="this.src='${fallbackImage}';">
                        <span class="text-xs text-center font-semibold">${digimonName}</span>
                    `;
                }
                cell.onclick = function() {
                    if (!isCenter) {
                        this.classList.toggle('checked');
                    }
                };
                bingoCard.appendChild(cell);
            }
            
            // Show bingo card and refresh button, hide loading
            bingoCard.classList.remove('hidden');
            refreshButton.classList.remove('hidden');
            loading.classList.add('hidden');
        }

        // Event listener for refresh button
        document.getElementById('refresh-button').addEventListener('click', generateBingoCard);

        // Generate initial bingo card
        generateBingoCard();
    </script>
</body>
</html>