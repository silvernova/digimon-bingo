<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digimon Cyber Sleuth Bingo Card</title>
    <!-- Use static Tailwind CSS from unpkg to avoid CDN warnings and production issues -->
    <link href="https://unpkg.com/tailwindcss@^3.3.0/dist/tailwind.min.css" rel="stylesheet">
    <!-- Favicon to suppress 404 error -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>?</text></svg>">
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX transpilation (though using createElement to minimize reliance) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Fallback styles if Tailwind fails */
        body { background-color: #1a202c; color: white; font-family: Arial, sans-serif; text-align: center; }
        .fallback { padding: 20px; color: #ff4444; }
        .grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; margin: 10px auto; max-width: 896px; }
        .cell { padding: 8px; background: #2d3748; border: 1px solid #4a5568; border-radius: 4px; }
        .cell:hover { background: #4a5568; }
        .free { background: #38a169; }
        .marked { background: #34d399; text-decoration: line-through; color: #ffffff; }
        .digimon-image { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; margin-bottom: 4px; }
        .loading { width: 40px; height: 40px; background: #4a5568; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; }
        .header { color: #63b3ed; font-size: 1.5rem; font-weight: bold; }
        .button { padding: 8px 16px; background: #3182ce; color: white; border-radius: 8px; cursor: pointer; }
        .button:hover { background: #2b6cb0; }
    </style>
</head>
<body>
    <div id="root">
        <!-- Fallback content if JavaScript fails -->
        <div class="fallback" id="fallback">
            Loading Digimon Bingo Card... If this persists, check the browser console (F12) for errors or ensure an internet connection for libraries.
        </div>
    </div>
    <script type="text/babel">
        console.log("Initializing Digimon Bingo Card app at", new Date().toLocaleString("en-GB", { timeZone: "Europe/London" }));

        const digimonList = [
            "Kuramon (IT1)", "Pabumon (IT1)", "Punimon (IT1)", "Botamon (IT1)", "Poyomon (IT1)",
            "Arcadiamon IT (IT2)", "Koromon (IT2)", "Tanemon (IT2)", "Tsunomon (IT2)", "Tsumemon (IT2)",
            "Tokomon (IT2)", "Nyaromon (IT2)", "Pagumon (IT2)", "Yokomon (IT2)", "Bukamon (IT2)",
            "Motimon (IT2)", "Wanyamon (IT2)", "Agumon (R)", "Agumon Blk (R)", "Arcadiamon R (R)",
            "Armadillomon (R)", "Impmon (R)", "Elecmon (R)", "Otamamon (R)", "Gaomon (R)",
            "Gazimon (R)", "Gabumon (R)", "Gabumon Blk (R)", "Guilmon (R)", "Kudamon (R)",
            "Keramon (R)", "Gotsumon (R)", "Goblimon (R)", "Gomamon (R)", "Syakomon (R)",
            "Zubamon (R)", "Solarmon (R)", "Chuumon (R)", "Terriermon (R)", "Tentomon (R)",
            "ToyAgumon (R)", "Dracmon (R)", "Dracomon (R)", "Dorumon (R)", "Hagurumon (R)",
            "Patamon (R)", "Hackmon (R)", "Palmon (R)", "DemiDevimon (R)", "Biyomon (R)",
            "Falcomon (R)", "FanBeemon (R)", "Veemon (R)", "Salamon (R)", "Betamon (R)",
            "Hawkmon (R)", "Mushroomon (R)", "Monodramon (R)", "Lalamon (R)", "Lucemon (R)",
            "Lunamon (R)", "Renamon (R)", "Lopmon (R)", "Wormmon (R)", "Ryudamon (R)",
            "Sistrmon Blnc (R)", "Sistrmon B Awk (R)", "IceDevimon (C)", "Icemon (C)",
            "Aquilamon (C)", "Agunimon (C)", "Arcadiamon C (C)", "Ankylomon (C)",
            "Ikkakumon (C)", "Wizardmon (C)", "Lobomon (C)", "Woodmon (C)",
            "Airdramon (C)", "ExVeemon (C)", "Angemon (C)", "Ogremon (C)",
            "Guardromon (C)", "Guardromon Gld (C)", "GaoGamon (C)", "Kabuterimon (C)",
            "ShellNumemon (C)", "Gargomon (C)", "Garurumon (C)", "Garurumon Blk (C)",
            "Kyubimon (C)", "Growlmon (C)", "Kurisarimon (C)", "Greymon (C)",
            "Greymon Blue (C)", "Clockmon (C)", "Kuwagamon (C)", "Gekomon (C)",
            "Geremon (C)", "Coredramon Blu (C)", "Coredramon Grn (C)", "GoldNumemon (C)",
            "Golemon (C)", "Cyclonemon (C)", "Sangloupmon (C)", "Sunflowmon (C)",
            "Seadramon (C)", "Coelamon (C)", "GeoGreymon (C)", "Sukamon (C)",
            "Starmon (C)", "Stingmon (C)", "Strikedramon (C)", "Zubaeagermon (C)",
            "Socerimon (C)", "Tankmon (C)", "MudFrigimon (C)", "Tyrannomon (C)",
            "Gatomon (C)", "Devimon (C)", "Turuiemon (C)", "Togemon (C)",
            "Dorugamon (C)", "Nanimon (C)", "Numemon (C)", "Birdramon (C)",
            "BaoHuckmon (C)", "Bakemon (C)", "Veedramon (C)", "Hudiemon (C)",
            "PlatinumSukam (C)", "BlackGatomon (C)", "Vegiemon (C)", "Peckmon (C)",
            "Meramon (C)", "Monochromon (C)", "Frigimon (C)", "Unimon (C)",
            "Raptordramon (C)", "Raremon (C)", "Leomon (C)", "Lekismon (C)",
            "Reppamon (C)", "Waspmon (C)", "Sistrmon Ciel (C)", "Sistrmon C Awk (C)",
            "MegaKabuterimn (U)", "Arcadiamon U (U)", "Antylamon (U)", "Andromon (U)",
            "Meteormon (U)", "Infermon (U)", "Myotismon (U)", "Wingdramon (U)",
            "BurningGreymn (U)", "AeroVeedramon (U)", "Etemon (U)", "Angewomon (U)",
            "Okuwamon (U)", "Garudamon (U)", "KendoGarurumn (U)", "Gigadramon (U)",
            "CatchMamemon (U)", "CannonBeemon (U)", "Groundramon (U)", "GrapLeomon (U)",
            "Grademon (U)", "Crescemon (U)", "Cyberdramon (U)", "Shakkoumon (U)",
            "Cherrymon (U)", "Silphymon (U)", "SuperStarmon (U)", "SkullGreymon (U)",
            "SkullSatamon (U)", "Zudomon (U)", "SaviorHuckmon (U)", "Taomon (U)",
            "Dragomon (U)", "Chirinmon (U)", "Dinobeemon (U)", "Digitamamon (U)",
            "SkullMeramon (U)", "Duramon (U)", "ShogunGekomon (U)", "Triceramon (U)",
            "DoruGreymon (U)", "Knightmon (U)", "Datamon (U)", "Paildramon (U)",
            "Panjyamon (U)", "Pandamon (U)", "Pumpkinmon (U)", "Piximon (U)",
            "HippoGryphomn (U)", "Phantomon (U)", "BlackKingNume (U)", "BlueMeramon (U)",
            "Vademon (U)", "Whamon (U)", "MagnaAngemon (U)", "Volcanomon (U)",
            "Matadormon (U)", "MachGaogamon (U)", "Mamemon (U)", "MegaSeadramon (U)",
            "Megadramon (U)", "WarGrowlmon (U)", "MetalGreymon (U)", "MetalGreymn B (U)",
            "MetalTyranomn (U)", "MetalMamemon (U)", "Monzaemon (U)", "Crowmon (U)",
            "RizeGreymon (U)", "Lilamon (U)", "Rapidmon (U)", "Lillymon (U)",
            "Lucemon FM (U)", "LadyDevimon (U)", "WereGarurumon (U)", "WereGarurum B (U)",
            "Wisemon (U)", "Arcadiamon M (M)", "Alphamon (M)", "UlforceVeedrm (M)",
            "Ebemon (M)", "Imperialdramon DM (M)", "Imperialdramon FM (M)", "Vikemon (M)",
            "Valkyrimon (M)", "Varodurumon (M)", "VenomMyotismon (M)", "WarGreymon (M)",
            "Ophanimon (M)", "Gaiomon (M)", "KaiserGreymon (M)", "ChaosGallantmon (M)",
            "Chaosdramon (M)", "Gankoomon (M)", "KingEtemon (M)", "Kuzuhamon (M)",
            "GranKuwagamon (M)", "GranDracmon (M)", "GroundLocomon (M)", "Gryphonmon (M)",
            "Craniamon (M)", "Kerpymon Blk (M)", "Kerpymon Good (M)", "Goldramon (M)",
            "SaberLeomon (M)", "Sakuyamon (M)", "Jesmon (M)", "ShineGreymon (M)",
            "ShineGreymon BM (M)", "Justimon (M)", "Kentaurosmon (M)", "Slayerdramon (M)",
            "Serjawmon (M)", "MegaGargomon (M)", "Darkdramon (M)", "TigerVespamon (M)",
            "Titamon (M)", "TyrantKabuterimon (M)", "Dianamon (M)", "Diaboromon (M)",
            "Creepymon (M)", "Gallantmon (M)", "Dynasmon (M)", "Durandamon (M)",
            "Leopardmon (M)", "Leopardmon LM (M)", "Dorugoramon (M)", "Neptunemon (M)",
            "HiAndromon (M)", "PileVolcamon (M)", "Barbamon (M)", "BanchoLeomon (M)",
            "Piedmon (M)", "Puppetmon (M)", "PlatinumNumemon (M)", "BlackWarGreymon (M)",
            "PrinceMamemon (M)", "Brakedramon (M)", "Plesiomon (M)", "HerculesKabuterimon (M)",
            "Beelzemon (M)", "Beelzemon BM (M)", "Belphemon SM (M)", "Hououmon (M)",
            "Magnadramon (M)", "Boltmon (M)", "MagnaGarurumon (M)", "MagnaGarurumon (SV) (M)",
            "Mastemon (M)", "MarineAngemon (M)", "Minervamon (M)", "MirageGaogamon (M)",
            "MirageGaogamon BM (M)", "Machinedramon (M)", "Megidramon (M)", "MetalEtemon (M)",
            "MetalGarurumon (M)", "MetalGarurumon (Blk) (M)", "MetalSeadramon (M)", "Merukimon (M)",
            "RustTyranomon (M)", "Leviamon (M)", "Lilithmon (M)", "Ravemon (M)",
            "Ravemon BM (M)", "Crusadermon (M)", "Rosemon (M)", "Rosemon BM (M)",
            "Lotosmon (M)", "Alphamon NX (M)", "Crusadermon NX (M)", "Leopardmon NX (M)",
            "Omnimon NX (M)", "Gallantmon NX (M)", "Armageddemon (UL)", "Arcadiamon UL (UL)",
            "Alphamon Ouryuken (UL)", "Imperialdramon PM (UL)", "Examon (UL)", "Omnimon (UL)",
            "Omnimon Zwart (UL)", "Chaosmon (UL)", "Chaosmon VA (UL)", "Susanomon (UL)",
            "Gallantmon CM (UL)", "Belphemon RM (UL)", "Lucemon SM (UL)", "Apocalymon (UL)",
            "Flamedramon (A)", "Magnamon (A)", "Rapidmon (Armor) (A)", "Shoutmon (O)", "OmniShoutmon (O)"
        ];

        // Function to fetch Digimon image from API
        async function fetchDigimonImage(digimonName) {
            try {
                // Clean name for API (remove stage, e.g., "Agumon (R)" -> "Agumon")
                const cleanName = digimonName.split(' (')[0].replace(/\s+/g, '-').toLowerCase();
                const response = await fetch(`https://digimon-api.vercel.app/api/digimon/name/${cleanName}`);
                if (response.ok) {
                    const data = await response.json();
                    return data[0] ? data[0].img : null; // Return first item's image if available
                }
            } catch (error) {
                console.error(`Error fetching image for ${digimonName}:`, error);
            }
            return null; // Fallback if API fails or Digimon not found
        }

        function generateBingoCard() {
            try {
                const shuffled = [...digimonList].sort(() => Math.random() - 0.5);
                const card = [];
                for (let i = 0; i < 5; i++) {
                    const row = shuffled.slice(i * 5, (i + 1) * 5);
                    if (i === 2) row[2] = "FREE SPACE";
                    card.push(row);
                }
                for (let i = 0; i < 5; i++) {
                    while (card[i].length < 5) card[i].push("FREE SPACE");
                }
                console.log("Generated card at", new Date().toLocaleString("en-GB", { timeZone: "Europe/London" }), ":", card);
                return card;
            } catch (error) {
                console.error("Error generating card at", new Date().toLocaleString("en-GB", { timeZone: "Europe/London" }), ":", error);
                return Array(5).fill().map(() => Array(5).fill("ERROR"));
            }
        }

        const BingoCard = () => {
            const [card, setCard] = React.useState(generateBingoCard());
            const [markedState, setMarkedState] = React.useState(Array(5).fill().map(() => Array(5).fill(false)));
            const [imageUrls, setImageUrls] = React.useState(Array(5).fill().map(() => Array(5).fill(null)));
            const [loadingImages, setLoadingImages] = React.useState(Array(5).fill().map(() => Array(5).fill(false)));

            // Fetch images for the current card
            React.useEffect(() => {
                const fetchAllImages = async () => {
                    const newImageUrls = [...imageUrls];
                    const newLoading = [...loadingImages];
                    for (let rowIndex = 0; rowIndex < 5; rowIndex++) {
                        for (let colIndex = 0; colIndex < 5; colIndex++) {
                            const digimon = card[rowIndex][colIndex];
                            if (digimon !== "FREE SPACE" && digimon !== "ERROR") {
                                newLoading[rowIndex][colIndex] = true;
                                const imgUrl = await fetchDigimonImage(digimon);
                                newImageUrls[rowIndex][colIndex] = imgUrl;
                                newLoading[rowIndex][colIndex] = false;
                            }
                        }
                    }
                    setImageUrls(newImageUrls);
                    setLoadingImages(newLoading);
                };
                fetchAllImages();
            }, [card]);

            const handleCellClick = (rowIndex, colIndex) => {
                const newMarkedState = [...markedState];
                newMarkedState[rowIndex][colIndex] = !newMarkedState[rowIndex][colIndex];
                setMarkedState(newMarkedState);
            };

            const handleGenerate = () => {
                console.log("Generating new card at", new Date().toLocaleString("en-GB", { timeZone: "Europe/London" }));
                setCard(generateBingoCard());
                setMarkedState(Array(5).fill().map(() => Array(5).fill(false))); // Reset marks
                setImageUrls(Array(5).fill().map(() => Array(5).fill(null))); // Reset images
                setLoadingImages(Array(5).fill().map(() => Array(5).fill(false))); // Reset loading
            };

            return React.createElement('div', { className: "flex flex-col items-center min-h-screen p-4" },
                React.createElement('h1', { className: "text-3xl font-bold text-blue-400 mb-6" }, "Digimon Cyber Sleuth Bingo"),
                React.createElement('button', {
                    onClick: handleGenerate,
                    className: "mb-6 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md transition duration-200"
                }, "Generate New Card"),
                React.createElement('div', { className: "grid grid-cols-5 gap-1 w-full max-w-2xl" },
                    ['B', 'I', 'N', 'G', 'O'].map((letter) =>
                        React.createElement('div', { key: letter, className: "text-center text-lg font-bold text-yellow-400" }, letter)
                    ),
                    card.flatMap((row, rowIndex) =>
                        row.map((digimon, colIndex) => {
                            const isMarked = markedState[rowIndex][colIndex];
                            const imgUrl = imageUrls[rowIndex][colIndex];
                            const isLoading = loadingImages[rowIndex][colIndex];
                            const cellContent = React.createElement('div', { className: "flex flex-col items-center" },
                                isLoading ? React.createElement('div', { className: "loading" }, "⏳") :
                                imgUrl ? React.createElement('img', { src: imgUrl, alt: digimon, className: "digimon-image" }) :
                                React.createElement('div', { className: "digimon-image bg-gray-600 flex items-center justify-center text-xs" }, "?")
                            );
                            return React.createElement('div', {
                                key: `${rowIndex}-${colIndex}`,
                                className: `p-2 bg-gray-800 border border-gray-700 rounded-md text-center text-sm hover:bg-gray-700 transition duration-200 cursor-pointer ${digimon === "FREE SPACE" ? "bg-green-600" : ""} ${isMarked ? "marked" : ""}`,
                                title: digimon,
                                onClick: () => handleCellClick(rowIndex, colIndex)
                            },
                                cellContent,
                                React.createElement('div', null, digimon.slice(0, 20))
                            );
                        })
                    )
                )
            );
        };

        try {
            console.log("Attempting to render React app at", new Date().toLocaleString("en-GB", { timeZone: "Europe/London" }));
            ReactDOM.render(React.createElement(BingoCard), document.getElementById('root'));
            console.log("React app rendered successfully at", new Date().toLocaleString("en-GB", { timeZone: "Europe/London" }));
            const fallback = document.getElementById('fallback');
            if (fallback) fallback.style.display = 'none';
        } catch (error) {
            console.error("Failed to render React app at", new Date().toLocaleString("en-GB", { timeZone: "Europe/London" }), ":", error);
            const root = document.getElementById('root');
            root.innerHTML = '<div class="fallback">Failed to load bingo card. Check console (F12) for details or ensure internet access for libraries.</div>';
        }
    </script>
</body>
</html>